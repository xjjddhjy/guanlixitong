<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>admin</title>
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="stylesheet" href="../css/page/css.css">
  <link rel="stylesheet" type="text/css" href="../lib/bootstrap/css/bootstrap.css">

  <link rel="stylesheet" type="text/css" href="../stylesheets/theme.css">
  <link rel="stylesheet" href="../lib/font-awesome/css/font-awesome.css">

  <script src="../lib/jquery-1.7.2.min.js" type="text/javascript"></script>

  <!-- Le fav and touch icons -->
  <link rel="shortcut icon" href=".../assets/ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href=".../assets/ico/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href=".../assets/ico/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href=".../assets/ico/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href=".../assets/ico/apple-touch-icon-57-precomposed.png">
</head>

<!--[if lt IE 7 ]> <body class="ie ie6"> <![endif]-->
<!--[if IE 7 ]> <body class="ie ie7 "> <![endif]-->
<!--[if IE 8 ]> <body class="ie ie8 "> <![endif]-->
<!--[if IE 9 ]> <body class="ie ie9 "> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!-->

<body>
  <!--<![endif]-->
  <div class="navbar">
    <div class="navbar-inner">
      <ul class="nav pull-right">
        <li>
          <a href="#" role="button">
            <i class="icon-user"></i><span id="title"></span>
          </a>
        </li>
        <li>
          <a href="../login.html" class="hidden-phone visible-tablet visible-desktop" role="button">Logout</a>
        </li>
      </ul>
      <a class="brand" href="index.html"><span class="second">Admin</span></a>
    </div>
  </div>

  <div class="sidebar-nav">
    <a href="#dashboard-menu" class="nav-header" data-toggle="collapse"><i class="icon-dashboard"></i>控制面板</a>
    <ul id="dashboard-menu" class="nav nav-list collapse in">
      <li><a href="./index.html">首页</a></li>
      <li><a href="../list.html">管理员管理</a></li>
      <li><a href="../chengji/list.html">成绩管理</a></li>
      <li><a href="../banji/list.html">班级管理</a></li>
      <li><a href="list.html">系部管理</a></li>
      <li><a href="../kemu/list.html">科目管理</a></li>
      <li><a href="../xuesheng/list.html">学生管理</a></li>
    </ul>
  </div>
  <div class="content">
    <div class="header">
      <h1 class="page-title">文章列表</h1>
    </div>
    <ul class="breadcrumb">
      <li><a href="../index.html">Home</a> <span class="divider">/</span></li>
      <li class="active">Index</li>
    </ul>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="btn-toolbar">
          <button id="btn-primary" class="btn btn-primary"><i class="icon-plus"></i>管理员管理</button>
          <div style="margin-top: 1px;"><input type="text" placeholder="输入dep_id" id="search"></div>
        </div>

        <div class="well">
          <table class="table">
            <thead>
              <tr>
                <th>dep_id</th>
                <th>部门名</th>
                <th style="width: 26px;"></th>
              </tr>
            </thead>
            <tbody>
              <!-- <tr>
                <td>1</td>
                <td>必须使用HTML5文档类型 Bootstrap使用的某些HTML元素</td>
                <td>2013-06-21</td>
                <td>
                  <a href="user.html"><i class="icon-pencil"></i></a>
                  <a href="#myModal" role="button" data-toggle="modal"><i class="icon-remove"></i></a>
                </td>
              </tr> -->
            </tbody>
          </table>
        </div>
        <div class="pagination">
          <ul>
            <li><a href="#">Prev</a></li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">Next</a></li>
          </ul>
        </div>

        <div class="modal small hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
          aria-hidden="true">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="myModalLabel">Delete Confirmation</h3>
          </div>
          <div class="modal-body">
            <p class="error-text"><i class="icon-warning-sign modal-icon"></i>Are you sure you want to delete the user?
            </p>
          </div>
          <div class="modal-footer">
            <button class="btn quxiao" data-dismiss="modal" aria-hidden="true">Cancel</button>
            <button class="btn btn-danger" data-dismiss="modal">Delete</button>
          </div>
        </div>

        <footer>
          <hr>
          <p>&copy; 2017 <a href="#" target="_blank">copyright</a></p>
        </footer>
      </div>
    </div>
  </div>

  <script src="../lib/bootstrap/js/bootstrap.js"></script>
  <script type="text/javascript">
    $("[rel=tooltip]").tooltip();
    $(function () {
      $('.demo-cancel-click').click(function () { return false; });
    });

  </script>
  <script>

    function post(url, data, callback) {
      const xhr = new XMLHttpRequest();
      xhr.open('post', url);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.onreadystatechange = function () {
        if (xhr.readyState == 4 && xhr.status == 200) {
          callback(xhr.responseText);
          // if (xhr.responseText == '登录成功') {
          //   alert('登录成功！'); location.href = 'index.html';
          // }
          //console.log(xhr.responseText);
          //console.log(JSON.parse(xhr.responseText));
          //return xhr.responseText;
        }
      }
      xhr.send(data);
    }
    function getLocalTime(nS) {
      return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\d{1,2}$/, ' ');
    }

    let fun1 = function (f) {
      console.log(f);
      let str = '';
      let data = JSON.parse(f).data;
      let page = JSON.parse(f).page;
      for (let i = 0; i < data.length; i++) {
        //let time = new Date(parseInt(data[i].createtime));
        str += `<tr>
                <td>${data[i].id}</td>
                <td>${data[i].name}</td>
                <td>
                  <a href="edit.php?dep_id=${data[i].id}"><i class="icon-pencil"></i></a>
                  <a href="#myModal" class='remove' role="button" data_id="${data[i].id}"
                  data-toggle="modal"><i class="icon-remove"></i></a>
                </td>
              </tr>`;
      }
      $('.well tbody').html(str);
      $('.pagination ul').html(page);

      $('.pagination ul a').click(function () {
        let href = $(this).attr('href');
        console.log(href, href.match(/(?<=.php[?]).*/)[0]);

        let str = href.match(/(?<=.php[?]).*/)[0];

        if ($('#search').val()) {
          str += `&search=${$('#search').val()}`
        }
        console.log(str);
        post('getdata.php', str,
          function (f1) {
            fun1(f1)
          }
        )
        return false;
      })
      $('.remove').click(function () {
        let id = $(this).attr('data_id');
        $('.btn-danger').attr('data_id', id)
        //console.log($('.btn-danger').attr('data_id'));
      })
      $('.btn-danger').click(function () {
        let id = $(this).attr('data_id');
        post('delete.php', `id=${id}`
          , function (f) {
            alert(f);
            location.reload();
          }
        )
      })
      // 双击切换到input
      $('.namefield').dblclick(function () {
        $(this).toggle().next().children().toggle();
      })
      // input触发blur事件时    
      $('.nameinput').blur(function () {
        // 拿到dom的数据
        let s1 = $(this).val();
        let s2 = $(this).parent().parent().prev().html();
        // 发送post请求
        post('editname.php', `id=${s2}&&name=${s1}`
          , f => {
            // 返回数据放到dom中，顺便切换还原回去
            $(this).toggle().parent().prev().toggle().html(f);
          }
        )
      })
      $('.nameinput').on('keypress', function (event) {
        if (event.keyCode == 13) {
          $(this).blur()
        }
      }
      )
    };


    post('getdata.php', ''
      , function (f1) {
        fun1(f1)
      }
    )
    $('#search').on('keypress', function (event) {
      if (event.keyCode == 13) {
        //alert('你输入的内容为1：' + $('#search').val());
        post('getdata.php', "search=" + $('#search').val()
          , function (f) {
            //console.log(f);
            let str = '';
            let data = JSON.parse(f).data;
            let page = JSON.parse(f).page;
            for (let i = 0; i < data.length; i++) {
              //let time = new Date(parseInt(data[i].createtime));
              str += `<tr>
                <td>${data[i].id}</td>
                <td>${data[i].name}</td>
                <td>
                  <a href="edit.php?dep_id=${data[i].id}"><i class="icon-pencil"></i></a>
                  <a href="#myModal" class='remove' role="button" data_id="${data[i].id}"
                  data-toggle="modal"><i class="icon-remove"></i></a>
                </td>
              </tr>`;
            }
            $('.well tbody').html(str);
            $('.pagination ul').html(page);

            $('.remove').click(function () {
              let dep_id = $(this).attr('data_id');
              $('.btn-danger').attr('data_id', dep_id)
              //console.log($('.btn-danger').attr('data_id'));
            })
            $('.btn-danger').click(function () {
              let dep_id = $(this).attr('data_id');
              post('delete.php', `dep_id=${dep_id}`
                , function (f) {
                  alert(f);
                  location.reload();
                }
              )
            })
          })
      }

    });
    post('getsession.php', ''
      , function (f) {
        $('#title').html(f);
      }
    )
    $('#btn-primary').click(function () {
      post('getsession.php', ''
        , function (f) {
          if (f != 'admin') {
            alert('你不是管理员')
            return false;
          } else {
            window.location = 'add.html';
          }
        }
      )

    })

  </script>

</body>

</html>